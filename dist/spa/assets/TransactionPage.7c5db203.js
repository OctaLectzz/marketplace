import{aR as Z,u as ss,r as p,aS as ts,d as L,w as as,k as es,m as a,x as l,q as t,p as n,a_ as E,a$ as os,aE as z,F as D,t as m,b0 as y,z as s,D as o,B as c,n as b,aD as $,v as is,C as R,aQ as ls,Q as x,A as N,b1 as ns,b2 as cs,a6 as rs}from"./index.3411a222.js";import{Q as V}from"./QSkeleton.72d58935.js";import{Q as ds}from"./QImg.602e0d0f.js";import{Q as C}from"./QBadge.64db8ae1.js";import{Q as P}from"./QSpinnerGears.11fcd29c.js";import{Q as us}from"./QSpace.b7b875dd.js";import{a as _s,Q as ms}from"./QItem.3b7e9927.js";import{C as j}from"./ClosePopup.5a4db590.js";import{u as ps}from"./use-quasar.a53b7e3f.js";import{url as vs}from"./axios.7b547941.js";import{u as hs}from"./user-store.70fb05d9.js";import{u as Q}from"./transaction-store.4971fc28.js";const gs={key:0},ys={key:1},xs=s("div",{class:"text-bold text-grey-7 transaction-title"},"Alamat Penerima",-1),bs={class:"row"},fs={class:"col-sm-4 col-xs-10 q-my-xs"},ks={class:"text-bold"},qs={key:0},ws={class:"col-sm-7 col-xs-10 q-my-xs"},Ps={key:0},Qs={key:0,class:"q-mr-xs"},Ss={key:1,class:"q-mr-xs"},Cs={key:2,class:"q-mr-xs"},Bs={key:3,class:"q-mr-xs"},Es={key:4,class:"q-mr-xs"},Ds={key:5,class:"q-mr-xs"},Ns={key:1},Ts={class:"text-grey-7 text-subtitle2"},As={class:"col-sm-1 col-xs-10 q-my-xs"},Is=s("div",{class:"text-bold text-grey-7 transaction-title"},"Alamat Pengirim",-1),zs={class:"row"},Rs={class:"col-sm-4 col-xs-10 q-my-xs"},Vs={class:"text-bold"},js={key:0},Hs={class:"col-sm-7 col-xs-10 q-my-xs"},Os={key:0},Us={key:0,class:"q-mr-xs"},Fs={key:1,class:"q-mr-xs"},Js={key:2,class:"q-mr-xs"},Ls={key:3,class:"q-mr-xs"},$s={key:4,class:"q-mr-xs"},Gs={key:5,class:"q-mr-xs"},Ks={key:1},Ws=s("div",{class:"text-grey-7 text-subtitle2"},"Alamat tidak tersedia.",-1),Ms=[Ws],Xs=s("div",{class:"col-sm-1 col-xs-10 q-my-xs"},null,-1),Ys=s("div",{class:"row text-grey-7 text-bold"},[s("div",{class:"col-sm-7 col-xs-4 transaction-title"},"Produk"),s("div",{class:"col-sm-2 col-xs-3 text-center transaction-title"},"Harga Satuan"),s("div",{class:"col-sm-1 col-xs-2 text-center transaction-title"},"Jumlah"),s("div",{class:"col-sm-2 col-xs-3 text-center transaction-title"},"Total")],-1),Zs={class:"col-sm-7 col-xs-4"},st={class:"flex"},tt={class:"transaction-subtitle"},at={class:"col-sm-2 col-xs-3 flex flex-center transaction-subtitle"},et={class:"col-sm-1 col-xs-2 flex flex-center transaction-subtitle"},ot={class:"col-sm-2 col-xs-3 flex flex-center transaction-subtitle"},it={class:"row justify-between"},lt={key:0,class:"col-sm-5 col-xs-10"},nt=s("div",{class:"text-bold text-grey-7 q-mb-sm q-mt-md transaction-title"},"Pesan",-1),ct={key:1,class:"col-sm-5 col-xs-10"},rt=s("div",{class:"text-bold text-grey-7 q-mb-sm q-mt-md transaction-title"},"Pesan",-1),dt={class:"transaction-subtitle"},ut={key:2,class:"col-sm-6 col-xs-10"},_t={key:0,class:"row"},mt={class:"col-5"},pt=s("div",{class:"text-bold text-grey-7 q-mb-sm q-mt-md transaction-title"},"Opsi Pengiriman",-1),vt={class:"text-bold transaction-title"},ht={class:"text-subtitle2 text-grey-8 transaction-subtitle"},gt={key:0},yt={class:"col-4"},xt=s("div",{class:"q-mb-sm q-mt-md transaction-title"},"\u200E",-1),bt={class:"text-subtitle2 text-bold transaction-title"},ft={key:0,class:"col-3"},kt=s("div",{class:"q-mb-sm q-mt-md transaction-title"},"\u200E",-1),qt={key:3,class:"col-sm-6 col-xs-10"},wt={key:0,class:"row"},Pt={class:"col-5"},Qt=s("div",{class:"text-bold text-grey-7 q-mb-sm q-mt-md transaction-title"},"Opsi Pengiriman",-1),St={class:"text-bold transaction-title"},Ct={class:"text-subtitle2 text-grey-8 transaction-subtitle"},Bt={key:0},Et={class:"col-4"},Dt=s("div",{class:"q-mb-sm q-mt-md transaction-title"},"\u200E",-1),Nt={class:"text-subtitle2 text-bold transaction-title"},Tt=s("div",{class:"col-3"},null,-1),At={class:"row"},It=s("div",{class:"col-md-6 col-sm-2 col-xs-2"},null,-1),zt={class:"col-md-4 col-sm-6 col-xs-8 transaction-title q-ml-auto"},Rt={class:"row"},Vt=s("div",{class:"col-7"},"Subtotal Produk",-1),jt={class:"col-5"},Ht={class:"row"},Ot=s("div",{class:"col-7"},"Ongkos Kirim",-1),Ut={class:"col-5"},Ft={class:"row q-my-sm"},Jt=s("div",{class:"col-7"},"Total Pembayaran",-1),Lt={class:"col-5 text-bold text-primary transaction-total"},$t={key:0,class:"large-screen col-12 flex justify-end q-mt-xl"},Gt={key:1,class:"small-screen col-12 flex justify-end q-mt-xl"},Kt=s("div",{class:"text-h6"},"Pilih Opsi Pengiriman",-1),Wt={class:"text-bold transaction-title"},Mt={class:"text-subtitle2 text-grey-8 transaction-subtitle"},Xt={class:"text-subtitle2 text-grey-8 transaction-subtitle"},Yt={key:0},Zt={class:"text-subtitle2 text-grey-8 transaction-subtitle"},sa={class:"text-subtitle2 text-bold float-right q-px-md transaction-title"},pa={__name:"TransactionPage",setup(ta){const g=ps(),H=Z(),T=ss(),A=p(!0),B=p(!0),_=p({}),G=async()=>{B.value=!0;try{const i=await hs().profile();_.value=i.data.data,S.value.origin=i.data.data.regency_id}catch(i){console.error("Error fetching data:",i)}},e=p([]),K=async i=>{A.value=!0;try{const u=await Q().show(i);e.value=u.data.data,S.value.destination=u.data.data.transaction_details[0].product.user.regency_id,d.value.product_price=u.data.data.product_price,d.value.id=u.data.data.id}catch(u){console.error("Error fetching data:",u)}A.value=!1};ts(async()=>{H.params.invoice&&(await G(),await K(H.params.invoice),M())});const O=p([]),v=p(null),I=p(!1),S=p({origin:null,destination:null,weight:0}),W=L(()=>e.value.transaction_details.reduce((i,u)=>i+u.product.weight*u.quantity,0)),M=async()=>{B.value=!0;try{S.value.weight=W.value,console.log(S.value);const i=await Q().ongkir(S.value);O.value=i.data,v.value=i.data[0],d.value.courier=i.data[0].courier+" "+i.data[0].service}catch(i){console.error("Error submitting form:",i),g.notify({message:i.response.data.message||"Terjadi kesalahan, Silahkan coba lagi nanti",icon:"warning",color:"negative"})}B.value=!1};as(()=>v.value,i=>{i&&(d.value.courier=i.courier+" "+i.service,d.value.shipping_estimation=i.etd,d.value.shipping_description=i.description,d.value.shipping_price=i.price,d.value.total_price=d.value.product_price+d.value.shipping_price)});const X=L(()=>d.value.product_price+d.value.shipping_price),f=p(!1),d=p({id:null,product_price:null,shipping_price:null,total_price:null,courier:"",shipping_estimation:"",shipping_description:"",note:""}),U=async()=>{f.value=!0;try{const u=(await Q().edit(d.value)).data.data.snap_token;window.snap.pay(u,{onSuccess:function(w){const r=p({id:d.value.id,shipping_status:1});Q().updateshipping(r.value),g.notify({message:"Pembayaran berhasil",color:"positive"}),T.push({name:"home.order.packaged"})},onPending:function(w){g.notify({message:"Menunggu pembayaran",color:"warning"})},onError:function(w){g.notify({message:"Pembayaran gagal",color:"negative"})},onClose:function(){g.notify({message:"Pembayaran ditutup",color:"info"})}})}catch(i){console.error("Error submitting form:",i),g.notify({message:i.response.data.message||"Terjadi kesalahan, Silahkan coba lagi nanti",icon:"warning",color:"negative"})}f.value=!1},k=p(!1),F=async()=>{k.value=!0;try{await Q().edit(d.value),T.push({name:"home.order.notyetpaid"})}catch(i){console.error("Error submitting form:",i),g.notify({message:i.response.data.message||"Terjadi kesalahan, Silahkan coba lagi nanti",icon:"warning",color:"negative"})}k.value=!1},q=p(!1),J=async()=>{g.dialog({title:"WARNING!!!",message:"Apakah anda yakin ingin membatalkan pesanan ini?",cancel:!0,persistent:!0}).onOk(async()=>{q.value=!0;try{const i=p({id:d.value.id,shipping_status:4});await Q().updateshipping(i.value),g.notify({message:"Berhasil membatalkan pesanan",icon:"check",color:"positive"}),T.push({name:"home.order.canceled"})}catch(i){console.error("Error submitting form:",i),g.notify({message:i.response.data.message||"Terjadi kesalahan, Silahkan coba lagi nanti",icon:"warning",color:"negative"})}q.value=!1})},h=i=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(i);return(i,u)=>{const w=es("router-link");return a(),l(z,null,[t(w,{to:{name:"home.order"},class:"link text-primary transaction-title q-mb-xl"},{default:n(()=>[t(D,{name:"arrow_back",size:"20px",class:"q-mx-sm"}),m(" Kembali ke halaman pesanan saya ")]),_:1}),B.value?(a(),l("div",gs,[t(V,{height:"250px",class:"q-my-md"}),t(V,{height:"400px",class:"q-my-md"}),t(V,{height:"300px",class:"q-my-md"})])):(a(),l("div",ys,[t(E,{class:"my-card q-my-md"},{default:n(()=>[t(y,{class:"bg-grey-2 text-body1 text-bold text-primary"},{default:n(()=>[t(D,{name:"pin_drop",size:"20px",class:"q-mx-sm"}),m(" Alamat Pengiriman ")]),_:1}),t(y,{class:"q-px-lg transaction-title"},{default:n(()=>[xs,s("div",bs,[s("div",fs,[s("div",ks,[m(o(_.value.name)+" ",1),_.value.phone_number?(a(),l("span",qs,"("+o(_.value.phone_number)+")",1)):c("",!0)])]),s("div",ws,[_.value.address_one?(a(),l("div",Ps,[_.value.address_one?(a(),l("span",Qs,o(_.value.address_one)+".",1)):c("",!0),_.value.address_two?(a(),l("span",Ss,"("+o(_.value.address_two)+")",1)):c("",!0),_.value.village?(a(),l("span",Cs,o(_.value.village)+",",1)):c("",!0),_.value.district?(a(),l("span",Bs,o(_.value.district)+",",1)):c("",!0),_.value.regency?(a(),l("span",Es,o(_.value.regency)+",",1)):c("",!0),_.value.province?(a(),l("span",Ds,o(_.value.province)+".",1)):c("",!0)])):(a(),l("div",Ns,[s("div",Ts,[m(" Anda belum mempunyai alamat. "),t(w,{to:{name:"home.setting"},class:"link text-primary"},{default:n(()=>[m("Silahkan membuat terlebih dahulu")]),_:1})])]))]),s("div",As,[e.value.shipping_status==0?(a(),b(w,{key:0,to:{name:"home.setting"},class:"link text-primary"},{default:n(()=>[m("Ubah")]),_:1})):c("",!0)])])]),_:1}),A.value?c("",!0):(a(),b(y,{key:0,class:"q-px-lg transaction-title"},{default:n(()=>[Is,s("div",zs,[s("div",Rs,[s("div",Vs,[m(o(e.value.transaction_details[0].product.user.name)+" ",1),e.value.transaction_details[0].product.user.phone_number?(a(),l("span",js,"("+o(e.value.transaction_details[0].product.user.phone_number)+")",1)):c("",!0)])]),s("div",Hs,[e.value.transaction_details[0].product.user.address_one?(a(),l("div",Os,[e.value.transaction_details[0].product.user.address_one?(a(),l("span",Us,o(e.value.transaction_details[0].product.user.address_one)+".",1)):c("",!0),e.value.transaction_details[0].product.user.address_two?(a(),l("span",Fs,"("+o(e.value.transaction_details[0].product.user.address_two)+")",1)):c("",!0),e.value.transaction_details[0].product.user.village?(a(),l("span",Js,o(e.value.transaction_details[0].product.user.village)+",",1)):c("",!0),e.value.transaction_details[0].product.user.district?(a(),l("span",Ls,o(e.value.transaction_details[0].product.user.district)+",",1)):c("",!0),e.value.transaction_details[0].product.user.regency?(a(),l("span",$s,o(e.value.transaction_details[0].product.user.regency)+",",1)):c("",!0),e.value.transaction_details[0].product.user.province?(a(),l("span",Gs,o(e.value.transaction_details[0].product.user.province)+".",1)):c("",!0)])):(a(),l("div",Ks,Ms))]),Xs])]),_:1}))]),_:1}),t(E,{class:"my-card q-my-md"},{default:n(()=>[t(y,{class:"bg-grey-2 text-body1 text-bold text-primary"},{default:n(()=>[t(D,{name:"shopping_cart_checkout",size:"20px",class:"q-mx-sm"}),m(" Pesanan ")]),_:1}),t(y,{class:"q-pa-lg"},{default:n(()=>[Ys,(a(!0),l(z,null,$(e.value.transaction_details,r=>(a(),l("div",{key:r.id,class:"row text-subtitle2 q-my-md"},[s("div",Zs,[s("div",st,[t(ds,{src:is(vs)+"/public/products/"+r.product.photos[0].photo,ratio:1/1,class:"q-mx-sm",style:{width:"30px"}},null,8,["src"]),s("span",tt,o(r.product.name),1)])]),s("div",at,o(h(r.product.price)),1),s("div",et,"x "+o(r.quantity),1),s("div",ot,o(h(r.product.price*r.quantity)),1)]))),128)),t(R,{class:"q-my-md"}),s("div",it,[e.value.shipping_status==0&&e.value.shipping_status==4?(a(),l("div",lt,[nt,t(ls,{modelValue:d.value.note,"onUpdate:modelValue":u[0]||(u[0]=r=>d.value.note=r),label:"Tinggalkan pesan (Opsional)",outlined:"",dense:""},null,8,["modelValue"])])):(a(),l("div",ct,[rt,s("div",dt,o(e.value.note),1)])),e.value.shipping_status==0||e.value.shipping_status==4?(a(),l("div",ut,[v.value?(a(),l("div",_t,[s("div",mt,[pt,s("div",vt,o(v.value.courier)+" "+o(v.value.service),1),s("div",ht,[s("div",null,o(v.value.description),1),s("div",null,[m(" Estimasi : "+o(v.value.etd)+" ",1),v.value.courier=="JNE"?(a(),l("span",gt,"Hari")):c("",!0)]),s("div",null,"Harga : "+o(h(v.value.price)),1)])]),s("div",yt,[xt,s("div",bt,o(h(v.value.price)),1)]),e.value.shipping_status==0?(a(),l("div",ft,[kt,s("div",{class:"link text-subtitle2 text-primary cursor-pointer transaction-title",onClick:u[1]||(u[1]=r=>I.value=!0)},"Ubah")])):c("",!0)])):c("",!0)])):c("",!0),e.value.shipping_status!=0&&e.value.shipping_status!=4?(a(),l("div",qt,[v.value?(a(),l("div",wt,[s("div",Pt,[Qt,s("div",St,o(e.value.courier),1),s("div",Ct,[s("div",null,o(e.value.shipping_description),1),s("div",null,[m(" Estimasi : "+o(e.value.shipping_estimation)+" ",1),e.value.courier=="JNE"?(a(),l("span",Bt,"Hari")):c("",!0)]),s("div",null,"Harga : "+o(h(e.value.shipping_price)),1)])]),s("div",Et,[Dt,s("div",Nt,o(h(e.value.shipping_price)),1)]),Tt])):c("",!0)])):c("",!0)])]),_:1})]),_:1}),t(E,{class:"my-card q-my-md"},{default:n(()=>[t(y,{class:"bg-grey-2 text-body1 text-bold text-primary"},{default:n(()=>[t(D,{name:"payments",size:"20px",class:"q-mx-sm"}),m(" Pembayaran "),e.value.shipping_status==0?(a(),b(C,{key:0,color:"grey",class:"float-right"},{default:n(()=>[m("Belum Dibayar")]),_:1})):c("",!0),e.value.shipping_status==1?(a(),b(C,{key:1,color:"warning",class:"float-right"},{default:n(()=>[m("Sedang Dikemas")]),_:1})):c("",!0),e.value.shipping_status==2?(a(),b(C,{key:2,color:"success",class:"float-right"},{default:n(()=>[m("Sedang Dikirim")]),_:1})):c("",!0),e.value.shipping_status==3?(a(),b(C,{key:3,color:"blue",class:"float-right"},{default:n(()=>[m("Selesai")]),_:1})):c("",!0),e.value.shipping_status==4?(a(),b(C,{key:4,color:"red",class:"float-right"},{default:n(()=>[m("Dibatalkan")]),_:1})):c("",!0)]),_:1}),t(y,{class:"q-pa-lg"},{default:n(()=>[s("div",At,[It,s("div",zt,[s("div",Rt,[Vt,s("div",jt,o(h(d.value.product_price)),1)]),s("div",Ht,[Ot,s("div",Ut,o(h(d.value.shipping_price)),1)]),s("div",Ft,[Jt,s("div",Lt,o(h(X.value)),1)])]),e.value.shipping_status==0?(a(),l("div",$t,[t(x,{color:"red",label:"Batalkan Pesanan",loading:q.value,disable:q.value,onClick:J,class:"q-ma-xs",flat:"","no-caps":""},{loading:n(()=>[t(P)]),_:1},8,["loading","disable"]),t(x,{color:"primary",label:"Bayar Nanti",loading:k.value,disable:k.value,onClick:F,class:"q-ma-xs",flat:"","no-caps":""},{loading:n(()=>[t(P)]),_:1},8,["loading","disable"]),t(x,{color:"primary",label:"Bayar Sekarang",loading:f.value,disable:f.value,onClick:U,class:"q-ma-xs","no-caps":""},{loading:n(()=>[t(P)]),_:1},8,["loading","disable"])])):c("",!0),e.value.shipping_status==0?(a(),l("div",Gt,[t(x,{color:"red",size:"sm",label:"Batalkan Pesanan",loading:q.value,disable:q.value,onClick:J,class:"q-ma-xs",flat:"","no-caps":""},{loading:n(()=>[t(P)]),_:1},8,["loading","disable"]),t(x,{color:"primary",size:"sm",label:"Bayar Nanti",loading:k.value,disable:k.value,onClick:F,class:"q-ma-xs",flat:"","no-caps":""},{loading:n(()=>[t(P)]),_:1},8,["loading","disable"]),t(x,{color:"primary",size:"md",label:"Bayar Sekarang",loading:f.value,disable:f.value,onClick:U,class:"q-ma-xs","no-caps":""},{loading:n(()=>[t(P)]),_:1},8,["loading","disable"])])):c("",!0)])]),_:1})]),_:1})])),t(os,{modelValue:I.value,"onUpdate:modelValue":u[3]||(u[3]=r=>I.value=r)},{default:n(()=>[t(E,null,{default:n(()=>[t(y,{class:"row items-center q-py-sm"},{default:n(()=>[Kt,t(us),N(t(x,{icon:"close",flat:"",round:"",dense:""},null,512),[[j]])]),_:1}),t(R),t(y,{class:"scroll",style:{height:"77vh"}},{default:n(()=>[(a(!0),l(z,null,$(O.value,r=>N((a(),b(ms,{tag:"label",key:r.id,class:"q-my-sm",clickable:""},{default:n(()=>[t(ns,{modelValue:v.value,"onUpdate:modelValue":u[2]||(u[2]=Y=>v.value=Y),val:r},null,8,["modelValue","val"]),t(_s,{class:"q-px-md"},{default:n(()=>[s("div",Wt,o(r.courier)+" "+o(r.service),1),s("div",Mt,o(r.description),1),s("div",Xt,[m(" Estimasi : "+o(r.etd)+" ",1),r.courier=="JNE"?(a(),l("span",Yt,"Hari")):c("",!0)]),s("div",Zt,"Harga : "+o(h(r.price)),1)]),_:2},1024),s("div",sa,o(h(r.price)),1)]),_:2},1024)),[[rs]])),128))]),_:1}),t(R),t(cs,{align:"right",class:"text-primary"},{default:n(()=>[N(t(x,{label:"Batal",color:"primary",flat:""},null,512),[[j]]),N(t(x,{label:"Pilih",color:"primary"},null,512),[[j]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};export{pa as default};
