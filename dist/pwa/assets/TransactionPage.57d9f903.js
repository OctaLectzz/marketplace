import{aR as Z,u as ss,r as v,aS as ts,d as J,w as es,k as as,m as t,n as y,p as r,q as e,O as D,t as m,x as o,a$ as x,z as s,D as i,B as n,aU as N,aD as L,aE as $,C as A,aP as is,Q as b,A as z,b0 as os,b1 as ls,v as ns,b2 as rs,a6 as cs}from"./index.30dd2348.js";import{Q as O}from"./QSkeleton.01e1d850.js";import{Q as ds}from"./QImg.3cf10b4b.js";import{Q}from"./QBadge.041d9b52.js";import{Q as w}from"./QSpinnerGears.3a9ff54e.js";import{Q as us}from"./QSpace.005ac978.js";import{Q as _s,a as ms}from"./QItem.2b7551f8.js";import{Q as ps}from"./QPage.b9e58bdc.js";import{C as R}from"./ClosePopup.b6be3405.js";import{u as vs}from"./use-quasar.67b6ac9a.js";import{url as hs}from"./axios.66ae61ea.js";import{u as gs}from"./user-store.f67a660c.js";import{u as P}from"./transaction-store.c0db26c0.js";const ys={key:0},xs={key:1},bs=s("div",{class:"text-bold text-grey-7 transaction-title"},"Alamat Penerima",-1),fs={class:"row"},ks={class:"col-sm-4 col-xs-10 q-my-xs"},qs={class:"text-bold"},ws={key:0},Ps={class:"col-sm-7 col-xs-10 q-my-xs"},Qs={key:0},Ss={key:0,class:"q-mr-xs"},Cs={key:1,class:"q-mr-xs"},Bs={key:2,class:"q-mr-xs"},Es={key:3,class:"q-mr-xs"},Ds={key:4,class:"q-mr-xs"},Ns={key:5,class:"q-mr-xs"},zs={key:6,class:"q-mr-xs"},Is={key:7,class:"q-mr-xs"},Ts={key:1},As={class:"text-grey-7 text-subtitle2"},Os={class:"col-sm-1 col-xs-10 q-my-xs"},Rs=s("div",{class:"text-bold text-grey-7 transaction-title"},"Alamat Pengirim",-1),Vs={class:"row"},js={class:"col-sm-4 col-xs-10 q-my-xs"},Hs={class:"text-bold"},Us={key:0},Fs={class:"col-sm-7 col-xs-10 q-my-xs"},Js={key:0},Ls={key:0,class:"q-mr-xs"},$s={key:1,class:"q-mr-xs"},Gs={key:2,class:"q-mr-xs"},Ks={key:3,class:"q-mr-xs"},Ws={key:4,class:"q-mr-xs"},Ms={key:5,class:"q-mr-xs"},Xs={key:6,class:"q-mr-xs"},Ys={key:7,class:"q-mr-xs"},Zs={key:1},st=s("div",{class:"text-grey-7 text-subtitle2"},"Alamat tidak tersedia.",-1),tt=[st],et=s("div",{class:"col-sm-1 col-xs-10 q-my-xs"},null,-1),at=s("div",{class:"row text-grey-7 text-bold"},[s("div",{class:"col-sm-7 col-xs-4 transaction-title"},"Produk"),s("div",{class:"col-sm-2 col-xs-3 text-center transaction-title"},"Harga Satuan"),s("div",{class:"col-sm-1 col-xs-2 text-center transaction-title"},"Jumlah"),s("div",{class:"col-sm-2 col-xs-3 text-center transaction-title"},"Total")],-1),it={class:"col-sm-7 col-xs-4"},ot={class:"flex"},lt={class:"transaction-subtitle"},nt={class:"col-sm-2 col-xs-3 flex flex-center transaction-subtitle"},rt={class:"col-sm-1 col-xs-2 flex flex-center transaction-subtitle"},ct={class:"col-sm-2 col-xs-3 flex flex-center transaction-subtitle"},dt={class:"row justify-between"},ut={key:0,class:"col-sm-5 col-xs-10"},_t=s("div",{class:"text-bold text-grey-7 q-mb-sm q-mt-md transaction-title"},"Pesan",-1),mt={key:1,class:"col-sm-5 col-xs-10"},pt=s("div",{class:"text-bold text-grey-7 q-mb-sm q-mt-md transaction-title"},"Pesan",-1),vt={class:"transaction-subtitle"},ht={key:2,class:"col-sm-6 col-xs-10"},gt={key:0,class:"row"},yt={class:"col-5"},xt=s("div",{class:"text-bold text-grey-7 q-mb-sm q-mt-md transaction-title"},"Opsi Pengiriman",-1),bt={class:"text-bold transaction-title"},ft={class:"text-subtitle2 text-grey-8 transaction-subtitle"},kt={key:0},qt={class:"col-4"},wt=s("div",{class:"q-mb-sm q-mt-md transaction-title"},"\u200E",-1),Pt={class:"text-subtitle2 text-bold transaction-title"},Qt={key:0,class:"col-3"},St=s("div",{class:"q-mb-sm q-mt-md transaction-title"},"\u200E",-1),Ct={key:1,class:"transaction-subtitle text-grey-7"},Bt=s("div",{class:"text-bold text-grey-7 q-mb-sm q-mt-md transaction-title"},"Opsi Pengiriman",-1),Et={key:3,class:"col-sm-6 col-xs-10"},Dt={key:0,class:"row"},Nt={class:"col-5"},zt=s("div",{class:"text-bold text-grey-7 q-mb-sm q-mt-md transaction-title"},"Opsi Pengiriman",-1),It={class:"text-bold transaction-title"},Tt={class:"text-subtitle2 text-grey-8 transaction-subtitle"},At={key:0},Ot={class:"col-4"},Rt=s("div",{class:"q-mb-sm q-mt-md transaction-title"},"\u200E",-1),Vt={class:"text-subtitle2 text-bold transaction-title"},jt=s("div",{class:"col-3"},null,-1),Ht={class:"row"},Ut=s("div",{class:"col-md-6 col-sm-2 col-xs-2"},null,-1),Ft={class:"col-md-4 col-sm-6 col-xs-8 transaction-title q-ml-auto"},Jt={class:"row"},Lt=s("div",{class:"col-7"},"Subtotal Produk",-1),$t={class:"col-5"},Gt={class:"row"},Kt=s("div",{class:"col-7"},"Ongkos Kirim",-1),Wt={class:"col-5"},Mt={class:"row q-my-sm"},Xt=s("div",{class:"col-7"},"Total Pembayaran",-1),Yt={class:"col-5 text-bold text-primary transaction-total"},Zt={key:0,class:"large-screen col-12 flex justify-end q-mt-xl"},se={key:1,class:"small-screen col-12 flex justify-end q-mt-xl"},te=s("div",{class:"text-h6"},"Pilih Opsi Pengiriman",-1),ee={class:"text-bold transaction-title"},ae={class:"text-subtitle2 text-grey-8 transaction-subtitle"},ie={class:"text-subtitle2 text-grey-8 transaction-subtitle"},oe={key:0},le={class:"text-subtitle2 text-grey-8 transaction-subtitle"},ne={class:"text-subtitle2 text-bold float-right q-px-md transaction-title"},ke={__name:"TransactionPage",setup(re){const g=vs(),V=Z(),S=ss(),I=v(!0),C=v(!0),c=v({}),G=async()=>{C.value=!0;try{const l=await gs().profile();c.value=l.data.data,B.value.origin=l.data.data.regency_id}catch(l){console.error("Error fetching data:",l)}},a=v([]),K=async l=>{I.value=!0;try{const _=await P().show(l);a.value=_.data.data,B.value.destination=_.data.data.transaction_details[0].product.user.regency_id,u.value.product_price=_.data.data.product_price,u.value.id=_.data.data.id}catch(_){console.error("Error fetching data:",_)}I.value=!1};ts(async()=>{V.params.invoice&&(await G(),await K(V.params.invoice),M(),c.value.id!=a.value.user_id&&S.push("/notfound"))});const j=v([]),p=v(null),T=v(!1),B=v({origin:null,destination:null,weight:0}),W=J(()=>a.value.transaction_details.reduce((l,_)=>l+_.product.weight*_.quantity,0)),M=async()=>{C.value=!0;try{if(B.value.weight=W.value,c.value.province&&c.value.regency){const l=await P().ongkir(B.value);j.value=l.data,p.value=l.data[0],u.value.courier=l.data[0].courier+" "+l.data[0].service}}catch(l){console.error("Error submitting form:",l),g.notify({message:l.response.data.message||"Terjadi kesalahan, Silahkan coba lagi nanti",icon:"warning",color:"negative"})}C.value=!1};es(()=>p.value,l=>{l&&(u.value.courier=l.courier+" "+l.service,u.value.shipping_estimation=l.etd,u.value.shipping_description=l.description,u.value.shipping_price=l.price,u.value.total_price=parseInt(u.value.product_price)+parseInt(u.value.shipping_price))});const X=J(()=>parseInt(u.value.product_price)+u.value.shipping_price),E=v(!1),u=v({id:null,product_price:null,shipping_price:null,total_price:null,courier:"",shipping_estimation:"",shipping_description:"",note:""}),H=async()=>{E.value=!0;try{const _=(await P().edit(u.value)).data.data.snap_token;window.snap.pay(_,{onSuccess:function(f){const d=v({id:u.value.id,shipping_status:1});P().updateshipping(d.value),g.notify({message:"Pembayaran berhasil",color:"positive"}),S.push({name:"home.order.packaged"})},onPending:function(f){g.notify({message:"Menunggu pembayaran",color:"warning"})},onError:function(f){g.notify({message:"Pembayaran gagal",color:"negative"})},onClose:function(){g.notify({message:"Pembayaran ditutup",color:"info"})}})}catch(l){console.error("Error submitting form:",l),g.notify({message:l.response.data.message||"Terjadi kesalahan, Silahkan coba lagi nanti",icon:"warning",color:"negative"})}E.value=!1},k=v(!1),U=async()=>{k.value=!0;try{await P().edit(u.value),S.push({name:"home.order.notyetpaid"})}catch(l){console.error("Error submitting form:",l),g.notify({message:l.response.data.message||"Terjadi kesalahan, Silahkan coba lagi nanti",icon:"warning",color:"negative"})}k.value=!1},q=v(!1),F=async()=>{g.dialog({title:"WARNING!!!",message:"Apakah anda yakin ingin membatalkan pesanan ini?",cancel:!0,persistent:!0}).onOk(async()=>{q.value=!0;try{const l=v({id:u.value.id,shipping_status:4});await P().updateshipping(l.value),g.notify({message:"Berhasil membatalkan pesanan",icon:"check",color:"positive"}),S.push({name:"home.order.canceled"})}catch(l){console.error("Error submitting form:",l),g.notify({message:l.response.data.message||"Terjadi kesalahan, Silahkan coba lagi nanti",icon:"warning",color:"negative"})}q.value=!1})},h=l=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(l);return(l,_)=>{const f=as("router-link");return t(),y(ps,null,{default:r(()=>[e(f,{to:{name:"home.order"},class:"link text-primary transaction-title q-mb-xl"},{default:r(()=>[e(D,{name:"arrow_back",size:"20px",class:"q-mx-sm"}),m(" Kembali ke halaman pesanan saya ")]),_:1}),C.value?(t(),o("div",ys,[e(O,{height:"250px",class:"q-my-md"}),e(O,{height:"400px",class:"q-my-md"}),e(O,{height:"300px",class:"q-my-md"})])):(t(),o("div",xs,[e(N,{class:"my-card q-my-md"},{default:r(()=>[e(x,{class:"bg-grey-2 text-body1 text-bold text-primary"},{default:r(()=>[e(D,{name:"pin_drop",size:"20px",class:"q-mx-sm"}),m(" Alamat Pengiriman ")]),_:1}),e(x,{class:"q-px-lg transaction-title"},{default:r(()=>[bs,s("div",fs,[s("div",ks,[s("div",qs,[m(i(c.value.name)+" ",1),c.value.phone_number?(t(),o("span",ws,"("+i(c.value.phone_number)+")",1)):n("",!0)])]),s("div",Ps,[c.value.province&&c.value.regency?(t(),o("div",Qs,[c.value.address_one?(t(),o("span",Ss,i(c.value.address_one)+".",1)):n("",!0),c.value.address_two?(t(),o("span",Cs,"("+i(c.value.address_two)+")",1)):n("",!0),c.value.village?(t(),o("span",Bs,i(c.value.village)+",",1)):n("",!0),c.value.district?(t(),o("span",Es,i(c.value.district)+",",1)):n("",!0),c.value.regency?(t(),o("span",Ds,i(c.value.regency)+",",1)):n("",!0),c.value.province?(t(),o("span",Ns,i(c.value.province)+",",1)):n("",!0),c.value.country?(t(),o("span",zs,i(c.value.country)+",",1)):n("",!0),c.value.zip_code?(t(),o("span",Is,i(c.value.zip_code)+".",1)):n("",!0)])):(t(),o("div",Ts,[s("div",As,[m(" Anda belum mempunyai alamat. "),e(f,{to:{name:"home.setting"},class:"link text-primary"},{default:r(()=>[m("Silahkan membuat terlebih dahulu")]),_:1})])]))]),s("div",Os,[a.value.shipping_status==0?(t(),y(f,{key:0,to:{name:"home.setting"},class:"link text-primary"},{default:r(()=>[m("Ubah")]),_:1})):n("",!0)])])]),_:1}),I.value?n("",!0):(t(),y(x,{key:0,class:"q-px-lg transaction-title"},{default:r(()=>[Rs,s("div",Vs,[s("div",js,[s("div",Hs,[m(i(a.value.transaction_details[0].product.user.name)+" ",1),a.value.transaction_details[0].product.user.phone_number?(t(),o("span",Us,"("+i(a.value.transaction_details[0].product.user.phone_number)+")",1)):n("",!0)])]),s("div",Fs,[a.value.transaction_details[0].product.user.address_one?(t(),o("div",Js,[a.value.transaction_details[0].product.user.address_one?(t(),o("span",Ls,i(a.value.transaction_details[0].product.user.address_one)+".",1)):n("",!0),a.value.transaction_details[0].product.user.address_two?(t(),o("span",$s,"("+i(a.value.transaction_details[0].product.user.address_two)+")",1)):n("",!0),a.value.transaction_details[0].product.user.village?(t(),o("span",Gs,i(a.value.transaction_details[0].product.user.village)+",",1)):n("",!0),a.value.transaction_details[0].product.user.district?(t(),o("span",Ks,i(a.value.transaction_details[0].product.user.district)+",",1)):n("",!0),a.value.transaction_details[0].product.user.regency?(t(),o("span",Ws,i(a.value.transaction_details[0].product.user.regency)+",",1)):n("",!0),a.value.transaction_details[0].product.user.province?(t(),o("span",Ms,i(a.value.transaction_details[0].product.user.province)+",",1)):n("",!0),a.value.transaction_details[0].product.user.country?(t(),o("span",Xs,i(a.value.transaction_details[0].product.user.country)+",",1)):n("",!0),a.value.transaction_details[0].product.user.zip_code?(t(),o("span",Ys,i(a.value.transaction_details[0].product.user.zip_code)+".",1)):n("",!0)])):(t(),o("div",Zs,tt))]),et])]),_:1}))]),_:1}),e(N,{class:"my-card q-my-md"},{default:r(()=>[e(x,{class:"bg-grey-2 text-body1 text-bold text-primary"},{default:r(()=>[e(D,{name:"shopping_cart_checkout",size:"20px",class:"q-mx-sm"}),m(" Pesanan ")]),_:1}),e(x,{class:"q-pa-lg"},{default:r(()=>[at,(t(!0),o(L,null,$(a.value.transaction_details,d=>(t(),o("div",{key:d.id,class:"row text-subtitle2 q-my-md"},[s("div",it,[s("div",ot,[e(ds,{src:ns(hs)+"/public/products/"+d.product.photos[0].photo,ratio:1/1,class:"q-mx-sm",style:{width:"30px"}},null,8,["src"]),s("span",lt,i(d.product.name),1)])]),s("div",nt,i(h(d.product.price)),1),s("div",rt,"x "+i(d.quantity),1),s("div",ct,i(h(d.product.price*d.quantity)),1)]))),128)),e(A,{class:"q-my-md"}),s("div",dt,[a.value.shipping_status==0&&a.value.shipping_status==4?(t(),o("div",ut,[_t,e(is,{modelValue:u.value.note,"onUpdate:modelValue":_[0]||(_[0]=d=>u.value.note=d),label:"Tinggalkan pesan (Opsional)",outlined:"",dense:""},null,8,["modelValue"])])):(t(),o("div",mt,[pt,s("div",vt,i(a.value.note),1)])),a.value.shipping_status==0||a.value.shipping_status==4?(t(),o("div",ht,[p.value&&c.value.province&&c.value.regency?(t(),o("div",gt,[s("div",yt,[xt,s("div",bt,i(p.value.courier)+" "+i(p.value.service),1),s("div",ft,[s("div",null,i(p.value.description),1),s("div",null,[m(" Estimasi : "+i(p.value.etd)+" ",1),p.value.courier=="JNE"?(t(),o("span",kt,"Hari")):n("",!0)]),s("div",null,"Harga : "+i(h(p.value.price)),1)])]),s("div",qt,[wt,s("div",Pt,i(h(p.value.price)),1)]),a.value.shipping_status==0?(t(),o("div",Qt,[St,s("div",{class:"link text-subtitle2 text-primary cursor-pointer transaction-title",onClick:_[1]||(_[1]=d=>T.value=!0)},"Ubah")])):n("",!0)])):(t(),o("div",Ct,[Bt,m(" Anda belum mempunyai alamat. "),e(f,{to:{name:"home.setting"},class:"link text-primary"},{default:r(()=>[m("Silahkan membuat terlebih dahulu")]),_:1})]))])):n("",!0),a.value.shipping_status!=0&&a.value.shipping_status!=4?(t(),o("div",Et,[p.value?(t(),o("div",Dt,[s("div",Nt,[zt,s("div",It,i(a.value.courier),1),s("div",Tt,[s("div",null,i(a.value.shipping_description),1),s("div",null,[m(" Estimasi : "+i(a.value.shipping_estimation)+" ",1),a.value.courier=="JNE"?(t(),o("span",At,"Hari")):n("",!0)]),s("div",null,"Harga : "+i(h(a.value.shipping_price)),1)])]),s("div",Ot,[Rt,s("div",Vt,i(h(a.value.shipping_price)),1)]),jt])):n("",!0)])):n("",!0)])]),_:1})]),_:1}),e(N,{class:"my-card q-my-md"},{default:r(()=>[e(x,{class:"bg-grey-2 text-body1 text-bold text-primary"},{default:r(()=>[e(D,{name:"payments",size:"20px",class:"q-mx-sm"}),m(" Pembayaran "),a.value.shipping_status==0?(t(),y(Q,{key:0,color:"grey",class:"float-right"},{default:r(()=>[m("Belum Dibayar")]),_:1})):n("",!0),a.value.shipping_status==1?(t(),y(Q,{key:1,color:"warning",class:"float-right"},{default:r(()=>[m("Sedang Dikemas")]),_:1})):n("",!0),a.value.shipping_status==2?(t(),y(Q,{key:2,color:"green",class:"float-right"},{default:r(()=>[m("Sedang Dikirim")]),_:1})):n("",!0),a.value.shipping_status==3?(t(),y(Q,{key:3,color:"blue",class:"float-right"},{default:r(()=>[m("Selesai")]),_:1})):n("",!0),a.value.shipping_status==4?(t(),y(Q,{key:4,color:"red",class:"float-right"},{default:r(()=>[m("Dibatalkan")]),_:1})):n("",!0)]),_:1}),e(x,{class:"q-pa-lg"},{default:r(()=>[s("div",Ht,[Ut,s("div",Ft,[s("div",Jt,[Lt,s("div",$t,i(h(u.value.product_price)),1)]),s("div",Gt,[Kt,s("div",Wt,i(h(u.value.shipping_price)),1)]),s("div",Mt,[Xt,s("div",Yt,i(h(X.value)),1)])]),a.value.shipping_status==0?(t(),o("div",Zt,[e(b,{color:"red",label:"Batalkan Pesanan",loading:q.value,disable:q.value,onClick:F,class:"q-ma-xs",flat:"","no-caps":""},{loading:r(()=>[e(w)]),_:1},8,["loading","disable"]),e(b,{color:"primary",label:"Bayar Nanti",loading:k.value,disable:k.value,onClick:U,class:"q-ma-xs",flat:"","no-caps":""},{loading:r(()=>[e(w)]),_:1},8,["loading","disable"]),e(b,{color:"primary",label:"Bayar Sekarang",loading:E.value,disable:!p.value,onClick:H,class:"q-ma-xs","no-caps":""},{loading:r(()=>[e(w)]),_:1},8,["loading","disable"])])):n("",!0),a.value.shipping_status==0?(t(),o("div",se,[e(b,{color:"red",size:"sm",label:"Batalkan Pesanan",loading:q.value,disable:q.value,onClick:F,class:"q-ma-xs",flat:"","no-caps":""},{loading:r(()=>[e(w)]),_:1},8,["loading","disable"]),e(b,{color:"primary",size:"sm",label:"Bayar Nanti",loading:k.value,disable:k.value,onClick:U,class:"q-ma-xs",flat:"","no-caps":""},{loading:r(()=>[e(w)]),_:1},8,["loading","disable"]),e(b,{color:"primary",size:"md",label:"Bayar Sekarang",loading:E.value,disable:!p.value,onClick:H,class:"q-ma-xs","no-caps":""},{loading:r(()=>[e(w)]),_:1},8,["loading","disable"])])):n("",!0)])]),_:1})]),_:1})])),e(ls,{modelValue:T.value,"onUpdate:modelValue":_[3]||(_[3]=d=>T.value=d)},{default:r(()=>[e(N,null,{default:r(()=>[e(x,{class:"row items-center q-py-sm"},{default:r(()=>[te,e(us),z(e(b,{icon:"close",flat:"",round:"",dense:""},null,512),[[R]])]),_:1}),e(A),e(x,{class:"scroll",style:{height:"77vh"}},{default:r(()=>[(t(!0),o(L,null,$(j.value,d=>z((t(),y(_s,{tag:"label",key:d.id,class:"q-my-sm",clickable:""},{default:r(()=>[e(rs,{modelValue:p.value,"onUpdate:modelValue":_[2]||(_[2]=Y=>p.value=Y),val:d},null,8,["modelValue","val"]),e(ms,{class:"q-px-md"},{default:r(()=>[s("div",ee,i(d.courier)+" "+i(d.service),1),s("div",ae,i(d.description),1),s("div",ie,[m(" Estimasi : "+i(d.etd)+" ",1),d.courier=="JNE"?(t(),o("span",oe,"Hari")):n("",!0)]),s("div",le,"Harga : "+i(h(d.price)),1)]),_:2},1024),s("div",ne,i(h(d.price)),1)]),_:2},1024)),[[cs]])),128))]),_:1}),e(A),e(os,{align:"right",class:"text-primary"},{default:r(()=>[z(e(b,{label:"Batal",color:"primary",flat:""},null,512),[[R]]),z(e(b,{label:"Pilih",color:"primary"},null,512),[[R]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{ke as default};
