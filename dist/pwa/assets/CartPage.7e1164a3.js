import{aX as A,aR as F,u as G,r as u,aS as H,d as $,w as C,k as J,m as l,n as M,p as k,z as e,q as c,aY as P,x as r,aD as x,aE as q,C as z,D as d,Q as B,B as K,v as L,aP as O,aZ as W,a_ as X}from"./index.30dd2348.js";import{Q as w}from"./QSkeleton.01e1d850.js";import{Q as Y}from"./QImg.3cf10b4b.js";import{Q as Z}from"./QSpinnerGears.3a9ff54e.js";import{Q as ee}from"./QPage.b9e58bdc.js";import{u as te}from"./use-quasar.67b6ac9a.js";import{url as ae}from"./axios.66ae61ea.js";import{u as S}from"./cart-store.978c541a.js";import{u as se}from"./transaction-store.c0db26c0.js";const i=h=>(W("data-v-28ea7a78"),h=h(),X(),h),oe={class:"table-container"},le={class:"responsive-table"},ce={class:"table-header"},re={class:"table-row-header"},ne={class:"table-cell-checklist"},ie=i(()=>e("td",{class:"table-cell-header-product"},"Produk",-1)),de=i(()=>e("td",{class:"table-cell"},"Harga Satuan",-1)),ue=i(()=>e("td",{class:"table-cell"},"Kuantitas",-1)),me=i(()=>e("td",{class:"table-cell"},"Total Harga",-1)),pe=i(()=>e("td",{class:"table-cell"},"Aksi",-1)),_e={key:0,class:"table-body"},he={key:1,class:"table-body"},ye={key:0},ve={class:"table-cell-checklist"},ge={class:"table-cell-product"},be={class:"row justify-center"},fe={class:"col-10"},ke={class:"component-products"},xe={class:"products-title text-h6 q-mt-sm q-ml-sm"},qe={class:"products-price text-body2 q-ml-sm",style:{color:"#ff7158"}},we={class:"table-cell"},Se={class:"table-cell"},Ie={class:"table-cell text-primary text-bold"},Qe={class:"table-cell text-primary text-bold"},Ve={key:1,class:"text-subtitle1 text-center text-grey-7 q-mt-md"},Ce=i(()=>e("div",{class:"text-h6 text-bold q-mt-md"},"Informasi Pembayaran",-1)),Pe={class:"row q-my-sm"},Be={class:"col-sm-5 col-xs-8 q-my-sm"},Ee=i(()=>e("div",{class:"text-body1 text-grey-7 text-bold"},"Produk yang dipilih",-1)),Ne={class:"col-sm-3 col-xs-8 q-my-sm"},De=i(()=>e("div",{class:"text-body1 text-grey-7 text-bold"},"Jumlah yang dibeli",-1)),Ue={class:"col-sm-2 col-xs-8 q-my-sm"},Re=i(()=>e("div",{class:"text-body1 text-grey-7 text-bold"},"Total Harga",-1)),Te={class:"text-body1 text-red text-bold"},je={class:"col-sm-2 col-xs-8 q-my-sm"},Ae={key:0,style:{"margin-bottom":"280px"}},Fe={__name:"CartPage",setup(h){const m=te(),E=F(),N=G(),I=u(!0),o=u([]),b=async()=>{try{const t=await S().getByUser();o.value=t.data.data,o.value.forEach(a=>{a.cartselected=!1})}catch(t){console.error("Error fetching data:",t)}I.value=!1};H(()=>{E.name=="home.cart"&&b()});const p=u([]),y=u(!1),D=t=>{y.value=t,o.value.forEach(a=>{a.cartselected=t}),Q()},Q=()=>{p.value=o.value.filter(t=>t.cartselected),y.value=o.value.length>0&&p.value.length===o.value.length},f=$(()=>o.value.filter(t=>t.cartselected).reduce((t,a)=>t+a.product.price*a.quantity,0)),U=(t,a)=>{let n=parseInt(t.target.value);isNaN(n)||n<1?n=1:n>parseInt(a.product.stock)&&(n=parseInt(a.product.stock)),a.quantity=n},R=async t=>{try{await S().edit(t)}catch(a){console.error("Error submitting form:",a),m.notify({message:"Jumlah pesanan tidak boleh melebihi stok",icon:"warning",color:"negative"})}b()};C(o,t=>{t.forEach(a=>{C(()=>a.quantity,n=>{R(a)})})},{deep:!0});const T=t=>{m.dialog({title:"WARNING!!!",message:"Apakah anda yakin?",cancel:!0,persistent:!0}).onOk(async()=>{try{await S().delete(t),m.notify({message:"Berhasil menghapus produk dari keranjang",icon:"check",color:"positive"}),b()}catch(a){console.error("Error submitting form:",a),m.notify({message:a.response.data.message||"Gagal menghapus produk dari keranjang",icon:"warning",color:"negative"})}})},V=u({product_price:f,total_price:f,transactiondetail:[]}),v=u(!1),j=async()=>{v.value=!0;try{V.value.transactiondetail=p.value.map(a=>({product_id:a.product_id,price:a.product.price,quantity:a.quantity}));const t=await se().create(V.value);N.push({name:"home.transaction",params:{invoice:t.data.data.invoice}})}catch(t){console.error("Error submitting form:",t),m.notify({message:t.response.data.message?"Silahkan pilih produk yang akan dibeli":"Produk gagal dibuat, Silahkan coba lagi nanti",icon:"warning",color:"negative"})}v.value=!1},g=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);return(t,a)=>{const n=J("router-link");return l(),M(ee,{class:"q-my-lg"},{default:k(()=>[e("div",oe,[e("table",le,[e("th",ce,[e("div",re,[e("td",ne,[c(P,{modelValue:y.value,"onUpdate:modelValue":[a[0]||(a[0]=s=>y.value=s),D]},null,8,["modelValue"])]),ie,de,ue,me,pe])]),I.value?(l(),r("tr",_e,[c(w,{height:"180px",class:"q-my-md"}),c(w,{height:"180px",class:"q-my-md"}),c(w,{height:"180px",class:"q-my-md"})])):(l(),r("tr",he,[o.value&&o.value.length>0?(l(),r("div",ye,[(l(!0),r(x,null,q(o.value,s=>(l(),r("div",{class:"table-row q-my-md",key:s.id},[e("td",ve,[c(P,{modelValue:s.cartselected,"onUpdate:modelValue":[_=>s.cartselected=_,Q],value:s.id},null,8,["modelValue","onUpdate:modelValue","value"])]),e("td",ge,[e("div",be,[e("div",fe,[c(n,{to:{name:"home.showproduct",params:{slug:s.product.slug}},class:"products-link"},{default:k(()=>[e("div",ke,[c(Y,{src:L(ae)+"/public/products/"+s.product.photos[0].photo,ratio:16/9,class:"products-image"},null,8,["src"])]),e("div",xe,d(s.product.name),1),e("div",qe,d(g(s.product.price)),1)]),_:2},1032,["to"])])])]),e("td",we,d(g(s.product.price)),1),e("td",Se,[c(O,{type:"number",modelValue:s.quantity,"onUpdate:modelValue":_=>s.quantity=_,modelModifiers:{number:!0},"input-class":"text-center",onInput:_=>U(t.event,s),dense:"",borderless:""},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",Ie,d(g(s.product.price*s.quantity)),1),e("td",Qe,[c(B,{color:"red",icon:"delete",onClick:_=>T(s.id)},null,8,["onClick"])])]))),128))])):(l(),r("div",Ve,"Tidak ada produk di keranjang."))]))])]),c(z,{class:"q-my-lg"}),Ce,e("div",Pe,[e("div",Be,[Ee,(l(!0),r(x,null,q(p.value,s=>(l(),r("div",{key:s.id,class:"text-subtitle2"},"- "+d(s.product.name),1))),128))]),e("div",Ne,[De,(l(!0),r(x,null,q(p.value,s=>(l(),r("div",{key:s.id,class:"text-subtitle2"},"x "+d(s.quantity),1))),128))]),e("div",Ue,[Re,e("div",Te,d(g(f.value)),1)]),e("div",je,[c(B,{color:"primary",label:"Beli Sekarang",onClick:j,loading:v.value,disable:v.value,"no-caps":""},{loading:k(()=>[c(Z)]),_:1},8,["loading","disable"])])]),o.value.length<3?(l(),r("div",Ae)):K("",!0)]),_:1})}}};var We=A(Fe,[["__scopeId","data-v-28ea7a78"]]);export{We as default};
